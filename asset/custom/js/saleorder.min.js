var count_enter_form_input_product=0;var count_list=0;$("#barcode").focus();$("#it_quantity").keypress(function(a){a.preventDefault()});$("#barcode").keyup(function(a){if(a.keyCode==13){var b=$.trim($(this).val());if(b!=""){check_barcode(b)}$(this).val("")}});$("#staffCode").keyup(function(b){if(b.keyCode==13){var a=$.trim($(this).val());if(a!=""){check_sale_person(a)}}});$("#cusTelephone_view").keyup(function(b){if(b.keyCode==13){var a=$.trim($(this).val());if(a!=""){check_customer(a)}}});$(document).ready(function(){$("#btnSaveCustomer").click(function(){if($("#cusTelephone").val()==""){alert("กรุณาใส่ เบอร์ติดต่อลูกค้า !");$("#cusTelephone").focus()}else{if($("#cusName").val()==""){alert("กรุณาใส่ ชื่อ-นามสกุลลูกค้า !");$("#cusName").focus()}else{$("#btnSaveCustomer").prop("disabled",true);$.ajax({type:"POST",url:link_new_customer,data:{name:$("#cusName").val(),address:$("#cusAddress").val(),province:$("#cusProvince").val(),telephone:$("#cusTelephone").val(),taxid:$("#cusTaxID").val()},success:function(b){if(b){alert("ทำการบันทึกข้อมูลลูกค้าเรียบร้อยแล้ว !");$("#cusName_view").val($("#cusName").val());var a=" ";if($("#cusProvince").val()!="กรุงเทพมหานคร"){a=" จ."}$("#cusAddress_view").val($("#cusAddress").val()+a+$("#cusProvince").val());$("#cusTaxID_view").val($("#cusTaxID").val());$("#cusTelephone_view").val($("#cusTelephone").val());$("#cusTelephone").val("");$("#cusName").val("");$("#cusAddress").val("");$("#cusTaxID").val("");$("#btnSaveCustomer").attr("disabled",false);$("#modNewCustomer").modal("toggle")}else{alert("ไม่สามารถ บันทึกข้อมูลลูกค้าได้ !")}}})}}});$("#btnPayment").click(function(){var d=0,c=0;var f=document.getElementsByName("it_srp");var h=document.getElementsByName("it_quantity");var a=document.getElementsByName("it_discount");var g=document.getElementsByName("it_net");var e=document.getElementsByName("it_dc_percent");for(var b=0;b<h.length;b++){d+=parseFloat(h[b].value);c+=parseFloat(h[b].value)*parseFloat(f[b].value)-parseFloat((a[b].value).replace(/,/g,""))}document.getElementById("totalPrice").value=c.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" บาท";document.getElementById("totalCount").value=d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")})});function check_barcode(a){if(a!=""){$.ajax({type:"POST",url:link,data:{barcode:a},success:function(c){if(c!=""){var b='<tr id="row'+count_enter_form_input_product+'"><td><button type="button" id="row'+count_enter_form_input_product+'" class="btn btn-danger btn-xs" onClick="delete_item_row('+count_enter_form_input_product+');"><i class="fa fa-close"></i></button></td>'+c+"</tr>";$("#itemlist > tbody").append(b);count_enter_form_input_product++;count_list++;setTimeout(function(){calculate()},300)}else{alert("ไม่พบ Barcode ที่ต้องการ")}}})}}function check_sale_person(a){if(a!=""){$.ajax({type:"POST",url:link_saleperson,data:{number:a},dataType:"json",success:function(b){if(b.nggu_id>0){$("#staffName").val(b.nggu_name);$("#staffCode").val(b.nggu_number)}else{alert("ไม่พบ รหัสพนักงาน ที่ต้องการ")}}})}}function check_customer(a){if(a!=""){$.ajax({type:"POST",url:link_customer,data:{telephone:a},dataType:"json",success:function(b){if(b.posc_id>0){$("#cusName_view").val(b.posc_name);$("#cusAddress_view").val(b.posc_address);$("#cusTaxID_view").val(b.posc_taxid)}else{alert("ไม่พบ ข้อมูลลูกค้า ที่ต้องการ")}}})}}function calculate(){var e=0,f=0,h=0,a=0,g=0;var c=document.getElementsByName("it_srp");var l=document.getElementsByName("it_quantity");var k=document.getElementsByName("it_discount");var j=document.getElementsByName("it_net");var d=document.getElementsByName("it_dc_percent");for(var b=0;b<l.length;b++){if(k[b].value==""){k[b].value=0}if(l[b].value==""){l[b].value=0}if(d[b].value==""){d[b].value=0}if(d[b].value<0){d[b].value=0}else{if(d[b].value>100){d[b].value=100}}e+=parseFloat(l[b].value);h+=parseFloat(l[b].value)*parseFloat(c[b].value);g=parseFloat(l[b].value)*parseFloat(c[b].value)*((d[b].value)/100);if(g>0){k[b].value=g.toFixed(2)}else{k[b].value=parseFloat(k[b].value).toFixed(2)}a+=parseFloat((k[b].value).replace(/,/g,""));f+=parseFloat(l[b].value)*parseFloat(c[b].value)-parseFloat((k[b].value).replace(/,/g,""));j[b].value=(parseFloat(l[b].value)*parseFloat(c[b].value)-parseFloat((k[b].value).replace(/,/g,""))).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}document.getElementById("summary").innerHTML=f.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" บาท";document.getElementById("allcount").innerHTML=e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");document.getElementById("sum_srp").innerHTML=h.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");document.getElementById("sum_dc").innerHTML=a.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");document.getElementById("sum_net").innerHTML=f.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function delete_item_row(a){count_list--;$("#row"+a).remove();setTimeout(function(){calculate()},300)}function numberWithCommas(c){var a=$(c).val();var b=a.toString().split(".");b[0]=b[0].replace(/,/g,"");b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");$(c).val(b.join("."))};