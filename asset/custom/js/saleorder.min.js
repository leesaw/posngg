var count_enter_form_input_product=0;var count_list=0;$("#barcode").focus();$("#it_quantity").keypress(function(a){a.preventDefault()});$("#barcode").keyup(function(a){if(a.keyCode==13){var b=$.trim($(this).val());if(b!=""){check_barcode(b)}$(this).val("")}});$("#staffCode").keyup(function(b){if(b.keyCode==13){var a=$.trim($(this).val());if(a!=""){check_sale_person(a)}}});$("#cusTelephone_view").keyup(function(b){if(b.keyCode==13){var a=$.trim($(this).val());if(a!=""){check_customer(a)}}});$("#valueDCTopup").keyup(function(a){if(a.keyCode==13){if($("#valueDCTopup").val()!=""){document.getElementById("dc_topup").innerHTML=parseFloat($("#valueDCTopup").val()).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");$("#hiddenDCTopup").val($("#valueDCTopup").val())}$("#valueDCTopup").val("");$("#modDCTopup").modal("toggle");setTimeout(function(){calculate()},300)}});$("#valueAllPercent").keyup(function(c){if(c.keyCode==13){var a=document.getElementsByName("it_dc_percent");if($("#valueAllPercent").val()!=""){for(var b=0;b<a.length;b++){a[b].value=$("#valueAllPercent").val()}}$("#valueAllPercent").val("");$("#modAllPercent").modal("toggle");setTimeout(function(){calculate()},300)}});$("#modAllPercent").on("shown.bs.modal",function(){$(this).find("[autofocus]").focus()});$("#modDCTopup").on("shown.bs.modal",function(){$(this).find("[autofocus]").focus()});$("#modNewCustomer").on("shown.bs.modal",function(){$(this).find("[autofocus]").focus()});$(document).ready(function(){$("#btnConfirmDCTopup").click(function(){if($("#valueDCTopup").val()!=""){document.getElementById("dc_topup").innerHTML=parseFloat($("#valueDCTopup").val()).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");$("#hiddenDCTopup").val($("#valueDCTopup").val())}$("#valueDCTopup").val("");$("#modDCTopup").modal("toggle");setTimeout(function(){calculate()},300)});$("#btnConfirmAllPercent").click(function(){var a=document.getElementsByName("it_dc_percent");if($("#valueAllPercent").val()!=""){for(var b=0;b<a.length;b++){a[b].value=$("#valueAllPercent").val()}}$("#valueAllPercent").val("");$("#modAllPercent").modal("toggle");setTimeout(function(){calculate()},300)});$("#btnSelectProductType").click(function(){var a="ต้องการให้ข้อมูลทั้งหมดในหน้านี้ ถูกลบใช่หรือไม่ !";return confirm(a)});$("#btnSaveCustomer").click(function(){if($("#cusTelephone").val()==""){alert("กรุณาใส่ เบอร์ติดต่อลูกค้า !");$("#cusTelephone").focus()}else{if($("#cusName").val()==""){alert("กรุณาใส่ ชื่อ-นามสกุลลูกค้า !");$("#cusName").focus()}else{$("#btnSaveCustomer").prop("disabled",true);$.ajax({type:"POST",url:link_new_customer,data:{name:$("#cusName").val(),address:$("#cusAddress").val(),province:$("#cusProvince").val(),telephone:$("#cusTelephone").val(),taxid:$("#cusTaxID").val()},success:function(b){if(b){alert("ทำการบันทึกข้อมูลลูกค้าเรียบร้อยแล้ว !");$("#cusName_view").val($("#cusName").val());var a=" ";if($("#cusProvince").val()!="กรุงเทพมหานคร"){a=" จ."}$("#cusAddress_view").val($("#cusAddress").val()+a+$("#cusProvince").val());$("#cusTaxID_view").val($("#cusTaxID").val());$("#cusTelephone_view").val($("#cusTelephone").val());$("#cusTelephone").val("");$("#cusName").val("");$("#cusAddress").val("");$("#cusTaxID").val("");$("#btnSaveCustomer").attr("disabled",false);$("#modNewCustomer").modal("toggle")}else{alert("ไม่สามารถ บันทึกข้อมูลลูกค้าได้ !")}},error:function(b,a){alert("เกิดความผิดพลาด !!!");$("#btnSaveCustomer").attr("disabled",false)}})}}});$("#btnPayment").click(function(){if($("#var_allcount").val()<1){alert("กรุณา สแกนบาร์โค้ด เพื่อเลือกสินค้า");$("#barcode").focus();return false}else{if($("#saleperson_id").val()<1){alert("กรุณาใส่ รหัสพนักงานขาย !");$("#staffCode").focus();return false}else{var d=0,e=0;var b=document.getElementsByName("it_srp");var j=document.getElementsByName("it_quantity");var h=document.getElementsByName("it_discount");var g=document.getElementsByName("it_net");var c=document.getElementsByName("it_dc_percent");var f=$("#hiddenDCTopup").val();for(var a=0;a<j.length;a++){d+=parseFloat(j[a].value);e+=parseFloat(j[a].value)*parseFloat(b[a].value)-parseFloat((h[a].value).replace(/,/g,""))}e-=f;document.getElementById("totalPrice").value=e.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" บาท";document.getElementById("totalCount").value=d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}});$("#btnConfirmPayment").click(function(){if($("#paymentValue").val()==""){alert("กรุณาใส่ จำนวนเงินที่ชำระ !");$("#paymentValue").focus()}else{$("#btnConfirmPayment").prop("disabled",true);var o=document.getElementsByName("it_id");var c=document.getElementsByName("it_barcode");var f=document.getElementsByName("it_srp");var n=document.getElementsByName("it_quantity");var l=document.getElementsByName("it_discount");var j=document.getElementsByName("it_net");var g=document.getElementsByName("it_dc_percent");var h=$("#hiddenDCTopup").val();var b=new Array();var e=0;var k=0;var m=0;for(var d=0;d<o.length;d++){e+=parseFloat((j[d].value).replace(/,/g,""));k+=parseFloat((l[d].value).replace(/,/g,""));b[d]={id:o[d].value,barcode:c[d].value,srp:(f[d].value).replace(/,/g,""),qty:n[d].value,dc_baht:(l[d].value).replace(/,/g,""),dc_percent:g[d].value,net:(j[d].value).replace(/,/g,""),}}m=(e-h)*0.07/1.07;var a={paymentWay:$("#paymentWay").val(),paymentValue:$("#paymentValue").val(),paymentRemark:$("#paymentRemark").val(),customer_id:$("#customer_id").val(),saleperson_id:$("#saleperson_id").val(),dc_topup:h,total_net:e,total_dc:k,total_tax:m,};$.ajax({type:"POST",url:link_save_payment,data:{item:b,payment:a},success:function(i){if(i>0){alert("ทำการบันทึกข้อมูลเรียบร้อยแล้ว !");$("#paymentValue").val("");$("#btnConfirmPayment").attr("disabled",false);$("#modPayment").modal("toggle");window.location=link_view_payment+"/"+i}else{alert("ไม่สามารถ บันทึกข้อมูลได้ !")}},error:function(p,i){alert("เกิดความผิดพลาด !!!");$("#btnConfirmPayment").attr("disabled",false)}})}})});function check_barcode(a){if(a!=""){$.ajax({type:"POST",url:link,data:{barcode:a},success:function(c){if(c!=""){var b='<tr id="row'+count_enter_form_input_product+'"><td><button type="button" id="row'+count_enter_form_input_product+'" class="btn btn-danger btn-xs" onClick="delete_item_row('+count_enter_form_input_product+');"><i class="fa fa-close"></i></button></td>'+c+"</tr>";$("#itemlist > tbody").append(b);count_enter_form_input_product++;count_list++;setTimeout(function(){calculate()},300)}else{alert("ไม่พบ Barcode ที่ต้องการ")}},error:function(c,b){alert("เกิดความผิดพลาด !!!")}})}}function check_sale_person(a){if(a!=""){$.ajax({type:"POST",url:link_saleperson,data:{number:a},dataType:"json",success:function(b){if(b.nggu_id>0){$("#saleperson_id").val(b.nggu_id);$("#staffName").val(b.nggu_name);$("#staffCode").val(b.nggu_number)}else{alert("ไม่พบ รหัสพนักงาน ที่ต้องการ");$("#saleperson_id").val("0");$("#staffName").val("");$("#staffCode").val("")}},error:function(c,b){alert("ไม่พบ รหัสพนักงาน ที่ต้องการ !!!");$("#saleperson_id").val("0");$("#staffName").val("");$("#staffCode").val("")}})}}function check_customer(a){if(a!=""){$.ajax({type:"POST",url:link_customer,data:{telephone:a},dataType:"json",success:function(b){if(b.posc_id>0){$("#customer_id").val(b.posc_id);$("#cusName_view").val(b.posc_name);$("#cusAddress_view").val(b.posc_address);$("#cusTaxID_view").val(b.posc_taxid)}else{alert("ไม่พบ ข้อมูลลูกค้า ที่ต้องการ");$("#customer_id").val("0");$("#cusTelephone_view").val("");$("#cusName_view").val("");$("#cusAddress_view").val("");$("#cusTaxID_view").val("")}},error:function(c,b){alert("ไม่พบ ข้อมูลลูกค้า ที่ต้องการ !!!");$("#customer_id").val("0");$("#cusTelephone_view").val("");$("#cusName_view").val("");$("#cusAddress_view").val("");$("#cusTaxID_view").val("")}})}}function calculate(){var e=0,f=0,h=0,a=0,g=0;var c=document.getElementsByName("it_srp");var m=document.getElementsByName("it_quantity");var l=document.getElementsByName("it_discount");var k=document.getElementsByName("it_net");var d=document.getElementsByName("it_dc_percent");var j=$("#hiddenDCTopup").val();for(var b=0;b<m.length;b++){if(l[b].value==""){l[b].value=0}if(m[b].value==""){m[b].value=0}if(d[b].value==""){d[b].value=0}if(d[b].value<0){d[b].value=0}else{if(d[b].value>100){d[b].value=100}}e+=parseFloat(m[b].value);h+=parseFloat(m[b].value)*parseFloat(c[b].value);g=parseFloat(m[b].value)*parseFloat(c[b].value)*((d[b].value)/100);if(g>0){l[b].value=g.toFixed(2)}else{l[b].value=parseFloat(l[b].value).toFixed(2)}a+=parseFloat((l[b].value).replace(/,/g,""));f+=parseFloat(m[b].value)*parseFloat(c[b].value)-parseFloat((l[b].value).replace(/,/g,""));k[b].value=(parseFloat(m[b].value)*parseFloat(c[b].value)-parseFloat((l[b].value).replace(/,/g,""))).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}f-=j;document.getElementById("summary").innerHTML=f.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" บาท";document.getElementById("allcount").innerHTML=e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");document.getElementById("sum_srp").innerHTML=h.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");document.getElementById("sum_dc").innerHTML=a.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");$("#var_allcount").val(e)}function delete_item_row(a){count_list--;$("#row"+a).remove();setTimeout(function(){calculate()},300)}function numberWithCommas(c){var a=$(c).val();var b=a.toString().split(".");b[0]=b[0].replace(/,/g,"");b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");$(c).val(b.join("."))};